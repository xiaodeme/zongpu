# 宗谱前端页面技术方案

## 1. 需求分析

### 1.1 核心功能需求
- **用户登录系统**：实现简单的用户认证，默认密码为123456
- **对话交互页面**：用户登录后进入对话页，可输入问题并获取后台返回的答案
- **响应式设计**：适配电脑和移动端设备

### 1.2 技术依赖
- 基于现有的LightRAG后端服务构建前端交互界面
- 利用现有的前端技术栈进行开发

## 2. 技术栈选择

### 2.1 前端框架
- **React 19**：利用组件化思想构建用户界面
- **TypeScript**：提供类型安全，增强代码可维护性
- **Vite**：现代化构建工具，提供快速开发体验

### 2.2 UI与样式
- **Tailwind CSS**：实用优先的CSS框架，支持响应式设计
- **Radix UI**：提供可访问性良好的基础组件
- **Lucide React**：提供现代化图标

### 2.3 状态管理与路由
- **Zustand**：轻量级状态管理库
- **React Router 7**：客户端路由管理

### 2.4 网络请求
- **Axios**：处理HTTP请求，支持拦截器和错误处理

### 2.5 工具库
- **Sonner**：轻量级通知组件
- **React Markdown**：支持富文本内容渲染

## 3. 架构设计

### 3.1 整体架构
- **组件化设计**：将页面拆分为可复用的组件
- **状态管理**：使用Zustand管理全局状态，包括认证状态和对话历史
- **API层**：封装与后端的交互，提供统一的接口
- **路由设计**：实现登录页和对话页的路由切换

### 3.2 目录结构
```
src/
├── api/              # API调用封装
│   └── lightrag.ts
├── components/       # 通用组件
│   └── ui/           # UI组件
├── features/         # 功能模块
│   ├── LoginPage.tsx # 登录页面
│   └── ChatPage.tsx  # 对话页面
├── stores/           # 状态管理
│   ├── state.ts      # 认证状态
│   └── chat.ts       # 对话状态
├── hooks/            # 自定义钩子
├── lib/              # 工具函数
└── AppRouter.tsx     # 路由配置
```

## 4. 页面设计

### 4.1 登录页面

#### 功能描述
- 提供用户名和密码输入框
- 实现登录验证逻辑
- 密码默认为123456
- 错误提示和加载状态

#### 组件设计
- **LoginPage**：主登录组件
- **LoginForm**：表单组件，包含输入验证
- **LoginButton**：登录按钮，处理加载状态

#### 技术实现
- 利用现有的`loginToServer`API进行身份验证
- 使用Zustand存储认证状态和token
- 登录成功后跳转到对话页面

### 4.2 对话页面

#### 功能描述
- 显示对话历史记录
- 提供问题输入框
- 实时显示加载状态和答案
- 支持清空对话记录

#### 组件设计
- **ChatPage**：对话页面主组件
- **ChatHistory**：显示对话历史的组件
- **ChatInput**：问题输入组件
- **MessageBubble**：消息气泡组件，区分用户和系统消息

#### 技术实现
- 使用WebSocket或轮询方式获取实时回复
- 将对话历史存储在本地状态
- 实现自动滚动到最新消息
- 添加输入防抖，避免频繁请求

## 5. 状态管理

### 5.1 认证状态
```typescript
// stores/state.ts
export const useAuthStore = create<AuthState>((set) => ({
  isAuthenticated: false,
  accessToken: '',
  isGuest: false,
  coreVersion: '',
  apiVersion: '',
  webuiTitle: null,
  webuiDescription: null,
  login: (token, isGuest, coreVersion, apiVersion, title, description) => set({ 
    isAuthenticated: true, 
    accessToken: token, 
    isGuest,
    coreVersion,
    apiVersion,
    webuiTitle: title,
    webuiDescription: description
  }),
  logout: () => set({ 
    isAuthenticated: false, 
    accessToken: '', 
    isGuest: false
  })
}))
```

### 5.2 对话状态
```typescript
// stores/chat.ts
export const useChatStore = create<ChatState>((set) => ({
  messages: [],
  isLoading: false,
  addMessage: (message) => set((state) => ({ 
    messages: [...state.messages, message] 
  })),
  setLoading: (loading) => set({ isLoading: loading }),
  clearMessages: () => set({ messages: [] })
}))
```

## 6. API交互

### 6.1 认证API
- **登录请求**：`POST /auth/login`
  - 参数：`username`, `password`
  - 响应：`{ access_token, user_info }`

### 6.2 对话API
- **发送问题**：`POST /query`
  - 参数：`query_text`, `mode`
  - 响应：`{ answer, sources }`

## 7. 响应式设计

### 7.1 断点设计
- **移动设备**：< 640px
- **平板设备**：640px - 1024px
- **桌面设备**：> 1024px

### 7.2 布局适配
- **移动设备**：单栏布局，最大化可用空间
- **平板/桌面**：更宽敞的布局，侧边可添加额外信息

### 7.3 交互适配
- **触摸友好**：按钮和输入区域足够大
- **键盘导航**：支持键盘操作
- **横竖屏切换**：自适应不同屏幕方向

## 8. 安全性考虑

### 8.1 认证安全
- 密码哈希存储
- 登录失败尝试限制
- JWT token认证机制

### 8.2 数据安全
- 敏感数据加密传输
- API请求携带token验证
- 防止XSS和CSRF攻击

## 9. 性能优化

### 9.1 前端优化
- 组件懒加载
- 图片优化
- 减少不必要的重渲染

### 9.2 网络优化
- API请求缓存
- 减少请求次数
- 合理的请求重试机制

## 10. 部署与集成

### 10.1 构建配置
- 使用Vite进行生产构建
- 代码分割和tree-shaking
- 静态资源压缩

### 10.2 集成方式
- 与LightRAG后端服务集成
- 支持Docker容器化部署
- 提供环境变量配置接口URL

## 11. 开发计划

### 11.1 阶段一：基础架构搭建
- 创建项目结构
- 配置开发环境
- 实现路由系统

### 11.2 阶段二：核心功能实现
- 登录页面开发
- 认证逻辑实现
- 对话页面开发

### 11.3 阶段三：功能完善
- 响应式适配
- 错误处理和用户反馈
- 性能优化

### 11.4 阶段四：测试与部署
- 单元测试和集成测试
- 性能测试
- 部署上线